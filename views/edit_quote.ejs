<%- include('partials/header', { title: `Edit Quote - ${quote.quote_number}` }) %>

<div class="card">
    <div class="card-header d-flex justify-content-between align-items-center">
        <h1>Editing Quote: <%= quote.quote_number %></h1>
        <a href="/admin" class="btn btn-secondary">Back to Dashboard</a>
    </div>
    <div class="card-body">
        <div class="alert alert-info"><strong>Customer details are hidden in this view.</strong></div>
        
        <div class="card mb-4">
            <div class="card-header">
                <h2>Quote Details</h2>
            </div>
            <div class="card-body">
                <p><strong>Gold (oz):</strong> $<span id="gold-oz-price"><%= Number(quote.spot_price_gold_ounce_nzd).toFixed(2) %></span></p>
                <p><strong>Gold (g):</strong> $<span id="gold-g-price"><%= Number(quote.spot_price_gold_gram_nzd).toFixed(2) %></span></p>
                <p><strong>Silver (oz):</strong> $<span id="silver-oz-price"><%= Number(quote.spot_price_silver_ounce_nzd).toFixed(2) %></span></p>
                <p><strong>Silver (g):</strong> $<span id="silver-g-price"><%= Number(quote.spot_price_silver_gram_nzd).toFixed(2) %></span></p>
                <p><i>Last Updated: <%= new Date(quote.updated_at).toLocaleString() %></i></p>
            </div>
        </div>
        
        <form action="/staff/quote/edit/<%= quote.id %>" method="POST">
            <div class="card">
                <div class="card-header">
                    <h3>Items</h3>
                </div>
                <div class="card-body">
                    <% items.forEach((item, index) => { %>
                        <div class="row align-items-center mb-3 p-2 border rounded">
                            <h5 class="col-12 mb-2"><%= item.item_name %></h5>
                            <input type="hidden" name="items[<%= index %>][id]" value="<%= item.id %>">
                            <div class="col-md-4">
                                <p><strong>Metal:</strong> <%= item.metal_type %></p>
                            </div>
                            <div class="col-md-4">
                                <label for="percent<%= index %>" class="form-label">Percent (%):</label>
                                <input type="number" class="form-control" id="percent<%= index %>" name="items[<%= index %>][percent]" value="<%= item.percent %>" step="0.01">
                            </div>
                            <div class="col-md-4">
                                <label for="weight<%= index %>" class="form-label">Weight (g):</label>
                                <input type="number" class="form-control" id="weight<%= index %>" name="items[<%= index %>][weight]" value="<%= item.weight %>" step="0.01">
                            </div>
                        </div>
                    <% }); %>
                </div>
            </div>
            
            <div class="mt-4">
                <button type="submit" class="btn btn-primary">Update Quote</button>
                <button type="button" class="btn btn-info" onclick="alert('Price refresh logic to be implemented.')">Refresh Live Price</button>
            </div>
        </form>
    </div>
</div>

<%- include('partials/footer') %>
